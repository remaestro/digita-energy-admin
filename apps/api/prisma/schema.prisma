// Prisma Schema for Digita Energy Admin
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Users table (managed by Supabase Auth, but we track additional data)
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projects Project[]

  @@map("users")
}

// Project templates
model Template {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String
  type        String   // fullstack-web-app, landing-page, mobile-app, api-service
  icon        String?
  category    String?
  variables   Json     // Template variables that need substitution
  metadata    Json?    // Additional metadata
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  projects Project[]

  @@map("templates")
}

// Generated projects
model Project {
  id          String   @id @default(uuid())
  name        String
  slug        String   @unique
  description String?
  templateId  String
  userId      String
  status      String   @default("created") // created, generating, ready, error
  config      Json?    // Project configuration (env vars, etc.)
  repoUrl     String?  // Git repository URL (if created)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  template    Template     @relation(fields: [templateId], references: [id])
  user        User         @relation(fields: [userId], references: [id])
  deployments Deployment[]

  @@map("projects")
}

// Deployment records
model Deployment {
  id           String   @id @default(uuid())
  projectId    String
  environment  String   // development, staging, production
  status       String   @default("pending") // pending, building, deploying, success, failed
  buildUrl     String?  // URL to build/deployment service
  deploymentUrl String? // Live URL of deployed app
  logs         String?  // Deployment logs
  triggeredBy  String   // User who triggered deployment
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("deployments")
}
